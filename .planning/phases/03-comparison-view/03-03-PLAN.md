---
phase: 03-comparison-view
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/components/comparison/HeroSummary.tsx
  - src/components/comparison/OptionsList.tsx
  - src/components/comparison/ComparisonView.tsx
autonomous: true

must_haves:
  truths:
    - "Hero card displays best option name, its net cost, and savings vs. returning"
    - "All five options appear in a ranked vertical list ordered by net cost ascending"
    - "Mini option totals row in hero card shows all five option costs for quick comparison"
    - "Tie note appears when top two options are within $100"
  artifacts:
    - path: "src/components/comparison/HeroSummary.tsx"
      provides: "Top snapshot card with best option, savings, caveat, tie note, and mini totals"
      exports: ["HeroSummary"]
    - path: "src/components/comparison/OptionsList.tsx"
      provides: "Ranked vertical list of all five OptionCards"
      exports: ["OptionsList"]
    - path: "src/components/comparison/ComparisonView.tsx"
      provides: "Page-level orchestrator composing HeroSummary + OptionsList"
      exports: ["ComparisonView"]
  key_links:
    - from: "src/components/comparison/ComparisonView.tsx"
      to: "src/components/comparison/HeroSummary.tsx"
      via: "renders HeroSummary with ComparisonData"
      pattern: "import.*HeroSummary"
    - from: "src/components/comparison/ComparisonView.tsx"
      to: "src/components/comparison/OptionsList.tsx"
      via: "renders OptionsList with sorted scenarios"
      pattern: "import.*OptionsList"
    - from: "src/components/comparison/OptionsList.tsx"
      to: "src/components/comparison/OptionCard.tsx"
      via: "renders one OptionCard per scenario"
      pattern: "import.*OptionCard"
---

<objective>
Build the three orchestrator React components for the comparison view: a hero summary card showing the best option and savings, a ranked options list composing OptionCards, and a top-level ComparisonView that ties everything together with disclaimers.

Purpose: These orchestrator components compose the leaf components (from 03-02) into the full comparison page layout.
Output: Three components in src/components/comparison/ â€” HeroSummary, OptionsList, and ComparisonView.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-comparison-view/03-CONTEXT.md
@.planning/phases/03-comparison-view/03-RESEARCH.md
@.planning/phases/03-comparison-view/03-01-SUMMARY.md
@.planning/phases/03-comparison-view/03-02-SUMMARY.md
@src/lib/types/scenario.ts
@src/lib/types/calculation.ts
@src/lib/calculations/evaluate-all.ts
@src/lib/utils/format-currency.ts
@src/components/comparison/LineItemsBreakdown.tsx
@src/components/comparison/OptionCard.tsx
@src/components/ui/card.tsx
@src/components/ui/badge.tsx
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HeroSummary and OptionsList components</name>
  <files>
    src/components/comparison/HeroSummary.tsx
    src/components/comparison/OptionsList.tsx
  </files>
  <action>
    **HeroSummary.tsx:**

    Create a component accepting `ComparisonData` from `@/lib/calculations/evaluate-all`.

    1. Use `Card` with `border-2 border-primary` for visual emphasis. Add `mb-6 md:mb-8` for spacing below.
    2. `CardHeader`:
       - `CardTitle` with `text-xl md:text-2xl font-bold`: Show "Best Move: {formatOptionName(bestOption.type)}"
       - `CardDescription` with direct financial tone:
         - If `bestOption.type === 'return'`: "Returning is your best option right now"
         - If `savingsVsReturn` > 0: "{formatOptionName(bestOption.type)} saves {formatCurrency(savingsVsReturn)} vs. returning"
         - If `savingsVsReturn` <= 0 and `bestOption.type !== 'return'`: "{formatOptionName(bestOption.type)} costs {formatCurrency(savingsVsReturn.abs())} more than returning"
    3. If `tie.isTie`, show a tie note below the description: a muted box (`bg-muted p-3 rounded-md text-sm text-muted-foreground mt-2`) with text: "{formatOptionName(tiedOptions[0])} and {formatOptionName(tiedOptions[1])} are within $100 -- either is a strong choice"
    4. Add a brief practical caveat in the hero card when the best option is sell-privately: `text-sm text-muted-foreground mt-1` saying "Requires finding a buyer". For early-termination: "Contact your leasing company for exact payoff". Otherwise, no caveat.
    5. `CardContent`: Mini option totals row. Use a responsive grid: `grid grid-cols-2 gap-3 sm:grid-cols-3 md:flex md:justify-between`. Each option shows:
       - Small label: `text-xs text-muted-foreground mb-1` with `formatOptionName(opt.type)`
       - Value: `font-semibold text-sm md:text-base` with `formatCurrency(opt.netCost)`
       - For the best option, add `text-primary font-bold` to distinguish it in the mini totals

    **OptionsList.tsx:**

    Create a component accepting `{ scenarios: ScenarioResult[] }` (already sorted ascending by netCost).

    1. Render a `div` with `space-y-4 md:space-y-6` containing one `OptionCard` per scenario.
    2. Pass `rank={index + 1}` and `isFirst={index === 0}` to each OptionCard.
    3. Map over scenarios maintaining sort order (do NOT re-sort here).

    This is a simple server component (no "use client" needed -- it just composes OptionCards).
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `grep -q 'export.*HeroSummary' src/components/comparison/HeroSummary.tsx` confirms HeroSummary is exported
    - `grep -q 'export.*OptionsList' src/components/comparison/OptionsList.tsx` confirms OptionsList is exported
    - HeroSummary.tsx imports ComparisonData from evaluate-all.ts
  </verify>
  <done>
    HeroSummary shows best option with savings text, tie note, caveat, and mini totals row. OptionsList renders the ranked vertical list of OptionCards.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ComparisonView orchestrator component</name>
  <files>
    src/components/comparison/ComparisonView.tsx
  </files>
  <action>
    Create a page-level orchestrator accepting `{ data: ComparisonData }`.

    1. Renders a container `div` with `max-w-4xl mx-auto px-4 py-8`.
    2. First child: `<HeroSummary>` with the full ComparisonData.
    3. Second child: `<OptionsList scenarios={data.scenarios} />`.
    4. Third child: A disclaimers section at the bottom. Collect unique disclaimers from all scenarios (deduplicate). Render in a `border-t mt-8 pt-6` section with `text-xs text-muted-foreground space-y-2`. Each disclaimer as a `<p>`.
    5. This is a server component (no "use client" -- it just composes children).
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `grep -q 'export.*ComparisonView' src/components/comparison/ComparisonView.tsx` confirms export
    - ComparisonView.tsx does NOT have "use client" (server component)
    - `grep -q 'HeroSummary' src/components/comparison/ComparisonView.tsx` confirms it imports HeroSummary
    - `grep -q 'OptionsList' src/components/comparison/ComparisonView.tsx` confirms it imports OptionsList
  </verify>
  <done>
    ComparisonView orchestrates HeroSummary + OptionsList + deduplicated disclaimers. The comparison view is fully composable and ready to be wired into a page route.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- all three component files type-check
2. `ls src/components/comparison/{HeroSummary,OptionsList,ComparisonView}.tsx` -- all three files exist
3. Grep for "use client" in ComparisonView.tsx -- absent (server component)
4. Grep for "formatCurrency" in HeroSummary.tsx -- currency formatting used for savings and mini totals
5. Grep for "OptionCard" in OptionsList.tsx -- composes OptionCard for each scenario
</verification>

<success_criteria>
- Hero card shows best option, savings vs. return, optional tie note, optional caveat, and mini totals
- Ranked list shows all five options via OptionCard components
- ComparisonView composes HeroSummary + OptionsList + disclaimers
- Server components where possible (ComparisonView, OptionsList)
- Mobile-first responsive layout (unprefixed = mobile, md:/lg: = larger)
</success_criteria>

<output>
After completion, create `.planning/phases/03-comparison-view/03-03-SUMMARY.md`
</output>
