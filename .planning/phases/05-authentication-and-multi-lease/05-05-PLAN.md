---
phase: 05-authentication-and-multi-lease
plan: 05
type: execute
wave: 4
depends_on: ["05-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can create an account and sign in through Clerk"
    - "Lease data is tied to the authenticated user"
    - "User can add a second lease and switch between leases"
    - "Unauthenticated visitors cannot access /lease routes"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete authentication and multi-lease flow in the browser.

Purpose: End-to-end verification that all four phase success criteria are met: account creation, user-scoped data, multi-lease support, and route protection.
Output: Verified working authentication and multi-lease system.
</objective>

<execution_context>
@/Users/brandonharvey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brandonharvey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-authentication-and-multi-lease/05-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply database migration and start dev server</name>
  <files></files>
  <action>
    1. Apply the database migration generated in Plan 02:
       ```bash
       npx drizzle-kit push
       ```
       (Use `push` for rapid prototyping -- simpler than `migrate` for development)

    2. Start the dev server:
       ```bash
       npm run dev
       ```

    3. Verify server starts without errors and Clerk integration loads.
  </action>
  <verify>
    - `npx drizzle-kit push` completes without errors
    - `npm run dev` starts and shows "Ready" message
    - No Clerk-related errors in console
  </verify>
  <done>Database schema is applied and dev server is running with Clerk integration</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete authentication and multi-lease system</what-built>
  <how-to-verify>
    Test all four success criteria in the browser:

    **1. Account creation and sign-in (AUTH-01):**
    - Visit http://localhost:3000
    - Click "Sign In" or "Sign Up"
    - Create an account (email or Google)
    - Verify you're redirected to /lease after sign-in

    **2. User-scoped data (AUTH-02):**
    - Add a new lease at /lease/new (fill essential fields)
    - Verify it appears in your lease list at /lease
    - View the comparison at /lease/{id}/compare
    - Sign out, sign back in -- same leases appear

    **3. Multi-lease support (AUTH-04):**
    - Add a second lease with different details
    - Verify both leases appear in the lease list
    - Click between them to see separate comparison results
    - Verify each lease shows its own data (not mixed)

    **4. Route protection (AUTH-05):**
    - Sign out
    - Try to visit http://localhost:3000/lease directly
    - Verify redirect to sign-in page
    - Try to visit http://localhost:3000/lease/new
    - Verify redirect to sign-in page

    **5. Header and navigation:**
    - When signed in, verify UserButton appears in header on all pages
    - Verify clicking "Lease Tracker" in header goes to lease list
    - Verify sign-out via UserButton menu works
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
All four phase success criteria verified in browser:
1. User can create an account and log in through Clerk
2. Lease data is tied to the authenticated user
3. User can add a second lease and switch between leases
4. Unauthenticated visitors cannot access lease data or comparison views
</verification>

<success_criteria>
Phase 5 is complete when all four success criteria pass end-to-end browser verification.
</success_criteria>

<output>
After completion, create `.planning/phases/05-authentication-and-multi-lease/05-05-SUMMARY.md`
</output>
