---
phase: 05-authentication-and-multi-lease
plan: 04
type: execute
wave: 3
depends_on: ["05-03"]
files_modified:
  - src/app/page.tsx
  - src/app/lease/page.tsx
  - src/app/lease/new/page.tsx
  - src/app/lease/[id]/edit/page.tsx
  - src/app/lease/[id]/compare/page.tsx
  - src/components/layout/Header.tsx
  - src/components/lease/LeaseCard.tsx
autonomous: true

must_haves:
  truths:
    - "Authenticated users land on a lease list page showing all their leases"
    - "Users can add multiple leases and each appears in the lease list"
    - "Users can click a lease to view its comparison, or edit/delete it"
    - "A header with UserButton is visible on all protected pages"
    - "First-time users see a clear empty state with CTA to add their first lease"
    - "The home page directs visitors to sign in"
  artifacts:
    - path: "src/components/layout/Header.tsx"
      provides: "App header with navigation and Clerk UserButton"
      contains: "UserButton"
    - path: "src/app/lease/page.tsx"
      provides: "Lease list page (home for authenticated users)"
    - path: "src/app/page.tsx"
      provides: "Public landing page directing to sign-in"
  key_links:
    - from: "src/app/lease/page.tsx"
      to: "src/app/lease/actions.ts (getLeases)"
      via: "Server Component data fetch"
      pattern: "getLeases"
    - from: "src/components/layout/Header.tsx"
      to: "@clerk/nextjs (UserButton)"
      via: "Clerk component import"
      pattern: "UserButton"
    - from: "src/components/lease/LeaseCard.tsx"
      to: "src/app/lease/[id]/compare/page.tsx"
      via: "Link navigation"
      pattern: "href.*lease.*compare"
---

<objective>
Restructure navigation so authenticated users land on a lease list, add a shared header with UserButton, create an empty state for new users, and update the public home page.

Purpose: This is the user-facing integration of auth. Users need to navigate between multiple leases, see who they're logged in as, and have a clear path from sign-up to first comparison.
Output: Complete multi-lease navigation with header, lease list as home, empty state, and public entry page.
</objective>

<execution_context>
@/Users/brandonharvey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brandonharvey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-authentication-and-multi-lease/05-RESEARCH.md
@.planning/phases/05-authentication-and-multi-lease/05-03-SUMMARY.md
@src/app/page.tsx
@src/app/lease/page.tsx
@src/components/lease/LeaseCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared header with UserButton and update home page</name>
  <files>
    src/components/layout/Header.tsx
    src/app/page.tsx
  </files>
  <action>
    1. Create `src/components/layout/Header.tsx`:
       - Import `SignedIn`, `SignedOut`, `SignInButton`, `UserButton` from `@clerk/nextjs`
       - Import `Link` from `next/link` and `Button` from `@/components/ui/button`
       - Build a header with:
         - Left: App name "Lease Tracker" as a Link to `/lease` (the lease list, post-login home)
         - Right (SignedIn): `<UserButton afterSignOutUrl="/" />` with appearance config for sizing (h-9 w-9 avatarBox)
         - Right (SignedOut): `<SignInButton mode="modal"><Button variant="outline" size="sm">Sign In</Button></SignInButton>`
       - Use existing design language: warm off-white background, teal accents, clean layout
       - Sticky header with border-bottom, padding, max-width container

    2. Update `src/app/page.tsx` (public home page):
       - Replace current content with a simple entry point:
         - Import `Header` component and render at top
         - Keep the "Lease Tracker" hero heading and description
         - Show `<SignedOut>`: "Sign In" and "Sign Up" buttons linking to `/sign-in` and `/sign-up`
         - Show `<SignedIn>`: "Go to Your Leases" button linking to `/lease`
         - Keep the `<LegalDisclaimer types={['general']} />` at bottom
       - This page is publicly accessible (not behind middleware)

    Decision: Lease list at `/lease` is the post-login home (not a dashboard). Research shows list views outperform dropdowns for 2-10 items.
    Decision: UserButton in header (not sidebar). Matches existing simple layout with no sidebar.
    Decision: Post-sign-out redirects to `/` (public home page).
  </action>
  <verify>
    - `src/components/layout/Header.tsx` exists and imports `UserButton` from `@clerk/nextjs`
    - `src/app/page.tsx` has conditional rendering for signed-in/signed-out states
    - `npx tsc --noEmit` passes
  </verify>
  <done>Header component shows app name + UserButton for signed-in users (or Sign In button for visitors). Home page is a clean entry point with auth-conditional CTAs.</done>
</task>

<task type="auto">
  <name>Task 2: Update lease list, detail pages, and add Header to all lease routes</name>
  <files>
    src/app/lease/page.tsx
    src/app/lease/new/page.tsx
    src/app/lease/[id]/edit/page.tsx
    src/app/lease/[id]/compare/page.tsx
    src/components/lease/LeaseCard.tsx
  </files>
  <action>
    1. Update `src/app/lease/page.tsx` (lease list - authenticated home):
       - Import and render `<Header />` at the top
       - Call `getLeases()` server action (now auth-scoped from Plan 03)
       - If no leases: Show empty state with:
         - Heading: "No leases yet"
         - Subtext: "Get started by adding your first vehicle lease to see your exit options."
         - CTA Button: "Add Your First Lease" linking to `/lease/new`
         - Keep it simple (no demo data or guided onboarding for MVP)
       - If leases exist: Show a grid of lease cards with:
         - Heading: "Your Leases" with "Add Lease" button top-right
         - Grid layout: `grid gap-4 md:grid-cols-2 lg:grid-cols-3`
         - Each card links to `/lease/{id}/compare` (comparison is the core value)

    2. Update `src/components/lease/LeaseCard.tsx`:
       - Add vehicle identification display: Show `{year} {make} {model}` if available, fallback to "Lease #{index}" or truncated ID
       - Show monthly payment and term progress (e.g., "X of Y months")
       - Keep existing design patterns (shadcn Card component, warm palette)
       - Card is clickable (Link wrapper) to comparison page
       - Keep edit and delete actions (existing two-click delete pattern)

    3. Add `<Header />` to `src/app/lease/new/page.tsx`, `src/app/lease/[id]/edit/page.tsx`, `src/app/lease/[id]/compare/page.tsx`:
       - Import and render `<Header />` at the top of each page
       - This ensures consistent navigation across all protected pages
       - Alternative: If a layout.tsx at /lease/ level doesn't exist, consider creating `src/app/lease/layout.tsx` that renders Header + children, avoiding repetition

    Decision: Create `src/app/lease/layout.tsx` with Header if one doesn't exist, to avoid repeating Header import in every page.
    Decision: No lease count limit for MVP. Personal use case unlikely to exceed ~5 leases.
    Decision: Expired leases stay visible (no archive). Users can delete manually with existing two-click confirmation.
    Decision: Lease identity: show `{year} {make} {model}` if fields populated, otherwise show "Untitled Lease" with monthly payment as identifier.
  </action>
  <verify>
    - `src/app/lease/page.tsx` calls `getLeases()` and renders empty state or lease grid
    - Lease cards display vehicle info or fallback identification
    - Header with UserButton appears on all lease pages (via layout or direct import)
    - `npx tsc --noEmit` passes
  </verify>
  <done>Authenticated users see their lease list with rich cards. Empty state guides first-time users. Header with UserButton provides consistent navigation and account controls on all pages.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Header component renders UserButton for signed-in users and Sign In for visitors
- Lease list page shows empty state when no leases exist
- Lease list page shows grid of lease cards when leases exist
- All lease pages have consistent Header navigation
- Home page shows auth-conditional CTAs
</verification>

<success_criteria>
Users have clear navigation: public home -> sign in -> lease list (with empty state or lease cards) -> add/edit/compare individual leases. Header with UserButton is present on all protected pages. Multi-lease support is fully navigable.
</success_criteria>

<output>
After completion, create `.planning/phases/05-authentication-and-multi-lease/05-04-SUMMARY.md`
</output>
