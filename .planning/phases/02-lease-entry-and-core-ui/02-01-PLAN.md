---
phase: 02-lease-entry-and-core-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - components.json
  - src/app/globals.css
  - tailwind.config.ts
  - src/lib/utils.ts
  - src/components/ui/form.tsx
  - src/components/ui/input.tsx
  - src/components/ui/button.tsx
  - src/components/ui/label.tsx
  - src/components/ui/popover.tsx
  - src/components/ui/tooltip.tsx
  - src/components/ui/select.tsx
  - src/lib/validations/lease-schema.ts
  - src/lib/content/field-tooltips.ts
autonomous: true

must_haves:
  truths:
    - "shadcn/ui components are initialized and available for import"
    - "Shared Zod schema validates all lease fields with friendly error messages"
    - "Tooltip content data exists for every confusing lease term"
    - "CSS variables define a warm, approachable color palette"
  artifacts:
    - path: "src/lib/validations/lease-schema.ts"
      provides: "Shared Zod schema for client+server validation"
      exports: ["leaseFormSchema", "LeaseFormData"]
      contains: "z.object"
    - path: "src/lib/content/field-tooltips.ts"
      provides: "Educational tooltip content for every lease field"
      exports: ["fieldTooltips"]
      contains: "whereToFind"
    - path: "src/components/ui/form.tsx"
      provides: "shadcn Form primitives"
      exports: ["Form", "FormField", "FormItem", "FormLabel", "FormControl", "FormMessage", "FormDescription"]
    - path: "components.json"
      provides: "shadcn/ui configuration"
      contains: "shadcn"
  key_links:
    - from: "src/lib/validations/lease-schema.ts"
      to: "src/lib/types/lease.ts"
      via: "Schema fields match existing Lease type properties"
      pattern: "monthlyPayment|termMonths|residualValue|currentMileage"
    - from: "src/app/globals.css"
      to: "tailwind.config.ts"
      via: "CSS variables consumed by Tailwind theme"
      pattern: "--primary|--background|--muted"
---

<objective>
Install form dependencies, initialize shadcn/ui with a warm color theme, and create the shared Zod validation schema and tooltip content data that all form components will consume.

Purpose: Establish the UI foundation (components, validation, content) before building the form itself. Everything in this plan is a prerequisite for form construction.
Output: Installable shadcn/ui components, shared Zod schema, tooltip content data, warm CSS theme.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-lease-entry-and-core-ui/02-CONTEXT.md
@.planning/phases/02-lease-entry-and-core-ui/02-RESEARCH.md
@src/lib/db/schema.ts
@src/lib/types/lease.ts
@src/app/globals.css
@tailwind.config.ts
@package.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and initialize shadcn/ui with warm theme</name>
  <files>
    package.json
    components.json
    src/app/globals.css
    tailwind.config.ts
    src/lib/utils.ts
    src/components/ui/form.tsx
    src/components/ui/input.tsx
    src/components/ui/button.tsx
    src/components/ui/label.tsx
    src/components/ui/popover.tsx
    src/components/ui/tooltip.tsx
    src/components/ui/select.tsx
  </files>
  <action>
    1. Install form dependencies:
       ```
       npm install react-hook-form @hookform/resolvers zod @radix-ui/react-popover @radix-ui/react-tooltip use-debounce
       ```

    2. Initialize shadcn/ui. The project uses Tailwind CSS 4 with @tailwindcss/postcss. Run `npx shadcn@latest init` and configure:
       - TypeScript: yes
       - Style: New York (more refined, matches warm aesthetic)
       - Base color: Neutral or Zinc (warm foundation)
       - CSS variables: yes
       - Path alias: @/* (matches existing tsconfig)
       - If the CLI asks about Tailwind CSS version or has issues, configure manually by creating components.json and the utils.ts (cn function from clsx + tailwind-merge).

    3. Add shadcn/ui components via CLI:
       ```
       npx shadcn@latest add form input button label popover tooltip select textarea
       ```
       If CLI fails (Tailwind 4 compatibility), manually create these components by copying from shadcn docs. The components are just React wrappers around Radix primitives.

    4. Configure a warm, approachable color palette in globals.css. The design direction is "Stripe checkout / Robinhood" -- financial but not intimidating. Define CSS variables for:
       - Primary: warm blue or teal (trustworthy but friendly)
       - Background: warm off-white (not pure white)
       - Card: slightly lighter warm tone
       - Muted: soft warm gray for descriptions
       - Destructive: warm red (not harsh)
       - Warning: amber/yellow for unusual-but-valid warnings
       - Border: soft warm gray
       - Rounded corners: use rounded-xl or rounded-2xl defaults for cards

    5. Ensure globals.css includes both light and dark mode CSS variable sets (dark mode can be minimal -- just functional). The design should feel premium and calming.

    6. Verify the tailwind.config.ts content path includes the new components directory pattern if not already present. The existing config already has `./src/components/**/*.{js,ts,jsx,tsx,mdx}` so this should work.

    IMPORTANT: If `npx shadcn@latest init` modifies tailwind.config.ts or globals.css in ways that break the existing setup, merge carefully. The project uses Tailwind CSS 4 via @tailwindcss/postcss plugin (not the older tailwindcss CLI). shadcn may need its CSS variables injected into the existing globals.css rather than replacing it.
  </action>
  <verify>
    - `npm ls react-hook-form zod @hookform/resolvers use-debounce` shows all installed
    - `components.json` exists with correct aliases
    - `src/components/ui/form.tsx` exists and exports Form, FormField, FormItem, FormLabel, FormControl, FormMessage, FormDescription
    - `src/components/ui/popover.tsx` exists
    - `src/components/ui/tooltip.tsx` exists
    - `src/lib/utils.ts` exists with `cn` function
    - `npx tsc --noEmit` passes (TypeScript compiles)
    - `npm run build` succeeds (Next.js build works with new deps)
  </verify>
  <done>
    shadcn/ui initialized with warm color theme. All required UI components (form, input, button, label, popover, tooltip, select) available for import. CSS variables define a warm, approachable palette. TypeScript and Next.js build pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared Zod validation schema and tooltip content data</name>
  <files>
    src/lib/validations/lease-schema.ts
    src/lib/content/field-tooltips.ts
  </files>
  <action>
    1. Create `src/lib/validations/lease-schema.ts` -- the single source of truth for form validation used by BOTH the client (React Hook Form resolver) and server (Server Actions).

       CRITICAL: Do NOT add "use client" or "use server" directives to this file. It must be importable from both contexts.

       Define the schema with TWO tiers matching progressive disclosure:

       **Essential fields (required):**
       - `monthlyPayment`: z.coerce.number().positive() -- friendly message: "Monthly payment should be a positive number. Check your lease for the amount due each month."
       - `termMonths`: z.coerce.number().int().min(12).max(84) -- message: "Lease terms are typically 24-48 months, but can range from 12 to 84."
       - `allowedMilesPerYear`: z.coerce.number().int().min(1000).max(100000) -- message: "Annual mileage allowance is usually between 10,000 and 15,000 miles."
       - `residualValue`: z.coerce.number().positive() -- message: "Residual value is what the car is expected to be worth at lease end."
       - `currentMileage`: z.coerce.number().int().nonnegative() -- message: "Enter your current odometer reading."

       **Optional fields (progressive disclosure section):**
       - `make`: z.string().max(100).optional()
       - `model`: z.string().max(100).optional()
       - `year`: z.coerce.number().int().min(2000).max(2030).optional()
       - `msrp`: z.coerce.number().positive().optional()
       - `netCapCost`: z.coerce.number().positive().optional()
       - `residualPercent`: z.coerce.number().min(0).max(100).optional()
       - `moneyFactor`: z.coerce.number().min(0).max(0.01).optional() -- message: "Money factor is usually between 0.0001 and 0.005. This seems unusual."
       - `downPayment`: z.coerce.number().nonnegative().optional().default(0)
       - `dispositionFee`: z.coerce.number().nonnegative().optional().default(0)
       - `purchaseFee`: z.coerce.number().nonnegative().optional().default(0)
       - `overageFeePerMile`: z.coerce.number().min(0).max(1).optional().default(0.25) -- standard default
       - `monthsElapsed`: z.coerce.number().int().nonnegative().optional().default(0)
       - `stateCode`: z.string().length(2).toUpperCase().optional()
       - `startDate`: z.coerce.date().optional()
       - `endDate`: z.coerce.date().optional()

       Add `.superRefine()` for cross-field warnings (not errors):
       - If residualValue > monthlyPayment * termMonths * 2, add WARNING (not error): "This residual value seems high relative to your payments. Double-check this value."
       - If monthlyPayment > 2000, add WARNING: "This is higher than most lease payments. Make sure this is the right amount."
       - If currentMileage > allowedMilesPerYear * (termMonths / 12) * 1.5, add WARNING: "You may be significantly over your mileage allowance."

       Export: `leaseFormSchema`, `LeaseFormData` (inferred type), and a `leaseWarningSchema` or separate warning check function that returns warnings (yellow) vs errors (red). The warning system should be a separate function that takes parsed data and returns `{ field: string, message: string }[]` -- warnings do NOT block submission.

    2. Create `src/lib/content/field-tooltips.ts` -- structured educational content for every lease field.

       Define an interface:
       ```typescript
       interface FieldTooltipContent {
         title: string;
         shortHint: string;        // Always-visible FormDescription text
         description: string;       // Detailed popover explanation (casual, friendly tone)
         whereToFind?: string;      // Where to find this on lease paperwork
         learnMoreUrl?: string;     // External resource (Edmunds, NerdWallet)
         example?: string;          // Example value for context
       }
       ```

       Create tooltip content for these fields (at minimum):
       - `monthlyPayment`: "The amount you pay each month to drive the car" / Where: "Page 1 of your lease agreement, usually near the top under 'Monthly Payment' or 'Base Monthly Payment'"
       - `termMonths`: "How many months your lease lasts" / Where: "Look for 'Lease Term' on the first page"
       - `allowedMilesPerYear`: "How many miles you can drive per year before extra charges kick in" / Where: "'Annual Mileage Allowance' or 'Mileage Limit' in your lease terms"
       - `residualValue`: "Think of this as what the dealer thinks your car will be worth when your lease is up. It's the price you'd pay to buy the car at lease end." / Where: "Page 2, under 'Residual Value' or 'Lease End Value'" / Link: Edmunds residual value article
       - `currentMileage`: "Your current odometer reading. We use this to project whether you'll be over or under your mileage limit."
       - `moneyFactor`: "A small decimal number (like 0.00125) that represents your interest rate. Multiply by 2,400 to get the approximate APR." / Where: "Your dealer might not show this directly. Ask for it, or look for 'Rent Charge' and calculate backwards." / Link: NerdWallet money factor article
       - `dispositionFee`: "A fee the leasing company charges when you return the car at lease end. Think of it as a 'restocking fee.'" / Where: "Look for 'Disposition Fee' in the fees section, usually $300-$500"
       - `msrp`: "The manufacturer's suggested retail price -- the 'sticker price' before any negotiation"
       - `netCapCost`: "The negotiated price of the car plus fees, minus your down payment. This is what you're actually financing." / Link: Edmunds cap cost article
       - `downPayment`: "Any upfront payment you made to reduce your monthly payments (also called 'cap cost reduction')"
       - `purchaseFee`: "A fee charged if you decide to buy the car at lease end"
       - `overageFeePerMile`: "The per-mile charge for driving more than your allowed miles. Usually $0.15-$0.30 per mile."
       - `stateCode`: "Your state affects tax calculations -- some states tax leases differently"
       - `residualPercent`: "Residual value as a percentage of MSRP. A higher percentage means the car holds its value better."

       Export: `fieldTooltips` as a `Record<string, FieldTooltipContent>` keyed by field name.

    TONE GUIDE: All tooltip text should sound like a knowledgeable friend explaining car leases over coffee. No jargon without explanation. Use "you" and "your." Include specific examples where helpful.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `src/lib/validations/lease-schema.ts` exports `leaseFormSchema` and `LeaseFormData`
    - `src/lib/content/field-tooltips.ts` exports `fieldTooltips` with entries for all essential fields
    - Schema correctly validates: positive monthlyPayment, integer termMonths 12-84, positive residualValue, nonnegative currentMileage
    - Schema makes optional fields truly optional (undefined passes validation)
    - Warning function returns warnings for unusual values without blocking submission
  </verify>
  <done>
    Shared Zod schema validates all lease form fields with friendly error messages and separate warning checks. Tooltip content data covers every lease field with plain-English descriptions, "where to find this" guidance, and external learning links. Both files have no "use client"/"use server" directive and can be imported from any context.
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with all new dependencies and shadcn components
- `npx tsc --noEmit` passes with no type errors
- shadcn/ui components render without CSS issues (verified by build, visual check in Plan 04)
- Zod schema properly validates essential fields as required and optional fields as optional
- Warning function identifies unusual-but-valid values without blocking
- Tooltip content exists for all fields defined in the schema
</verification>

<success_criteria>
1. All form dependencies installed (react-hook-form, zod, @hookform/resolvers, radix-ui, use-debounce)
2. shadcn/ui initialized with warm color palette CSS variables
3. UI components available: form, input, button, label, popover, tooltip, select
4. Zod schema exports leaseFormSchema with 5 required + ~14 optional fields
5. Warning function returns field-level warnings for unusual values
6. Tooltip content covers all fields with friendly descriptions and "where to find" guidance
7. TypeScript and Next.js build pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-lease-entry-and-core-ui/02-01-SUMMARY.md`
</output>
